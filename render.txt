# Deploying NovaCard Marketplace to Render (No Local Console Needed)

## Step 1 – Connect GitHub and fork the repo
1. Fork `Loveago/novacar` into your GitHub account (or ensure you have push access).
2. Sign in to [Render](https://dashboard.render.com/) with the same GitHub profile and authorize repository access.

## Step 2 – Provision the database on Render
1. In Render, click **New → PostgreSQL**.
2. Choose a name like `novacard-db`, pick the free tier, and click **Create Database**.
3. After the instance is live, open it and copy the **Internal Database URL** (Render auto-rotates credentials). You’ll paste this into the web service as `DATABASE_URL`.

## Step 3 – Create the Web Service
1. Click **New → Web Service** and select your `novacar` repo.
2. Configure:
   - **Branch:** `main`
   - **Root Directory:** `.`
   - **Environment:** `Node`
   - **Region:** closest to your users
   - **Instance Type:** Starter (or higher if needed)
3. Build & run commands:
   - **Build Command:** `npm install && npm run build`
   - **Start Command:** `npm run start`
4. Add environment variables (click **Advanced → Environment → Add Environment Variable**):
   - `DATABASE_URL` → use the Internal DB URL from Step 2.
   - `AUTH_SECRET` → long random string (e.g., `openssl rand -hex 32`).
   - `CARD_SECRET` → another random string (used by your payout helpers).
   - `NEXTAUTH_URL` → `https://<your-render-service>.onrender.com`
   - `AUTO_SEED` → set to `true` for the first deploy (auto-creates the admin user + initial gift cards at runtime).
   - Optional seed overrides:
     - `SEED_ADMIN_EMAIL`
     - `SEED_ADMIN_PASSWORD`
     - `SEED_SELLER_EMAIL`
     - `SEED_SELLER_PASSWORD`
   - Optional: set `NODE_ENV=production` (Render does this automatically, but it doesn’t hurt).
5. Click **Create Web Service**. Render will start the first build.

## Step 4 – Database setup on Render Free (no console / no jobs)
Render Free typically doesn’t offer Jobs/SSH. This app can seed itself when `AUTO_SEED=true`.

1. Make sure your database schema is created (migrations) at least once.
   - If you can’t run `npx prisma migrate deploy` on Render, run it from your own machine using the Render `DATABASE_URL`.
2. For initial data (admin user + gift cards), set `AUTO_SEED=true` and redeploy.
3. After you confirm you can log in and the marketplace has data, you can set `AUTO_SEED` back to `false`.

## Step 5 – Verify the deployment
1. Wait for the web service build to finish (status "Live").
2. Visit the Render URL shown in the dashboard.
3. Log in with the seeded credentials:
   - Admin: `admin@novacard.com / Admin123!`
   - Seller: `seller@novacard.com / Seller123!`
4. Check `/marketplace`, `/dashboard`, `/sell/<slug>`, and `/admin/gift-cards` to confirm data loads.

## Step 6 – Ongoing maintenance
- **Environment changes:** Update env vars under the web service’s **Environment** tab → **Save Changes → Deploy Latest Commit**.
- **DB credentials rotation:** Render rotates passwords when you hit "Regenerate Credentials" in the Postgres dashboard. Update the `DATABASE_URL` env var and redeploy.
- **Schema updates:** Push code, then run the `prisma-migrate` job to apply migrations.
- **Rollbacks:** Use the **Deploys** tab on the web service to roll back to an earlier successful build.

> Tip: If you prefer automation, convert the `prisma-migrate` job into a **Cron Job** (e.g., run daily) or add a GitHub Action that triggers Render’s Deploy Hook after pushing migrations.
